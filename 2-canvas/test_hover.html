<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
      <style> 
      *,*:before{ 
      	    padding: 0;
            margin: 0;
            word-wrap:break-word;
  -webkit-box-sizing: border-box;
     -moz-box-sizing: border-box;
          box-sizing: border-box;
        }
        svg{
        	position: relative;
        	 cursor: pointer;
        	 }
        #fade{ 
            display: none; 
            width: 100%; 
            height: 100%; 
            position: absolute;
            top: 0;
            left: 0;
            /*background-color: #333333; 
            -moz-opacity: 0.8; 
            opacity:.80; 
            filter: alpha(opacity=80);*/
        } 
        #fade > div{cursor: pointer;}
        .lightbox{  
        	display: block; 
            position: absolute;
            z-index:1002; 
        }
       
        #rectBox { 
            width: 100px; 
            height: 100px; 
            background-color: red;   
        } 
        #ellipseBox{
            width: 100px; 
            height: 40px;
            background-color: black;
        }
        #el-1{
            width: 100px; 
            height: 5px;
            background-color: gainsboro;
        }
        #re-1,#el-2{
        	width: 5px; 
            height: 100px;
            background-color:lavenderblush;
        }
        #pathBox,#re-2{
            width: 200px; 
            height: 100px; 
            background-color: yellow;
        }
        
    </style> 
    <script type="text/javascript" src="js/jquery-1.7.2.min.js" ></script>
    <!--<script type="text/javascript" src="http://sandbox.runjs.cn/js/sandbox/jquery/jquery-1.8.3.min.js" ></script>-->
</head>
<body>
    <svg width="640" height="480" xmlns="http://www.w3.org/2000/svg"  style="margin-top:100px;">
       <g>
         <title>Layer 1</title>
         <rect x="0" y="0" width="51" height="35" id="svg_1" class="light" data-src = "#rectBox" fill="#FF0000" stroke="#000000" stroke-width="5" data-fill = "#FF0000" data-stroke = "#000000" />
         <ellipse cx="69" cy="56" id="svg_2" fill="#0000ff" data-src="#ellipseBox" stroke="#000000" stroke-width="5" rx="24" ry="15" data-fill = "#0000ff" data-stroke = "#000000"/>
         <path d="m130.66666,23.16666c0,2 -5.98624,20.56885 -9,52c-0.38179,3.98174 -0.08769,6.03067 1,9c1.85227,5.05659 2.88134,13.02521 4,18c0.90456,4.02266 3,9 5,12c0,0 0.07613,-0.38268 1,0c1.30656,0.5412 13.91295,4.37258 26,7c26.83244,5.83269 49.9626,7.49937 60,8c7.99007,0.39851 16.97923,-2.09584 26,-4c9.97816,-2.10625 13.86926,-2.30196 19,-6c4.05621,-2.92355 4.02609,-8.14206 2,-19c-1.33542,-7.15658 -4,-15 -4,-16c0,-1 -1.1731,-2.85273 -2,-4c-2.6149,-3.62798 -8.50432,-8.59399 -13,-11c-4.9875,-2.66924 -5,-5 -5,-5c-3,-1 -5.92467,-3.62698 -20,-5c-18.93642,-1.8472 -27.60896,-4.06147 -35,-1c-1.30656,0.54119 -2.53493,0.31075 -4,2c-2.07193,2.38895 -4.99023,8.79026 -6,16c-0.41611,2.971 0,4 0,6c0,1 0,2 0,2c1,0 2.69344,2.4588 4,3c0.92387,0.38268 -0.15224,-0.23463 -2,-1c-2.61313,-1.08239 -4,-2 -6,-2c-1,0 -0.93414,-0.14429 -3,-1c-2.92157,-1.21015 -3.30449,0.53073 -7,-1c-3.91969,-1.62359 -4.34619,-2.70546 -6,-5c-2.6149,-3.62798 -3.41589,-6.76108 -5,-10c-1.38936,-2.84072 -3.513,-5.594 -5,-8c-1.66251,-2.68999 -3,-6 -3,-10c0,-5 0,-8 0,-10c0,0 0,-1 0,-3c0,-3 0.22975,-4.02675 0,-5c-0.51375,-2.17625 -1.69255,-2.18601 -3,-4c-1.65381,-2.29454 -3.1731,-2.85273 -4,-4c-1.30745,-1.81399 -3,-3 -4,-4l-1,0l-1,0l-1,0" id="" stroke-linecap="null" stroke-linejoin="null" data-src = "#pathBox" stroke-dasharray="null" stroke-width="5" stroke="#000000" fill="#7f0000" data-fill = "#7f0000" data-stroke = "#000000"/>
         <ellipse cx="10" cy="196" id="svg_4" fill="#0000ff" data-src="#el-1" stroke="#000000" stroke-width="5" rx="24" ry="15" data-fill = "#0000ff" data-stroke = "#000000"/>
         <rect x="400" y="0" width="51" height="35" id="rect_1" class="light" data-src = "#re-1" fill="#FF0000" stroke="#000000" stroke-width="5" data-fill = "#FF0000" data-stroke = "#000000" />
         
         <ellipse cx="20" cy="296" id="svg_4" fill="#0000ff" data-src="#el-2" stroke="#000000" stroke-width="5" rx="24" ry="15" data-fill = "#0000ff" data-stroke = "#000000"/>
         <rect x="400" y="300" width="51" height="35" id="" class="light" data-src = "#re-2" fill="#FF0000" stroke="#000000" stroke-width="5" data-fill = "#FF0000" data-stroke = "#000000" />
         <rect x="600" y="0" width="51" height="35" id="" class="light" data-src = "#re-2" fill="#FF0000" stroke="#000000" stroke-width="5" data-fill = "#FF0000" data-stroke = "#000000" />
         <rect x="600" y="300" width="51" height="35" id="" class="light" data-src = "#re-2" fill="#FF0000" stroke="#000000" stroke-width="5" data-fill = "#FF0000" data-stroke = "#000000" />
         <rect x="300" y="440" width="51" height="35" id="" class="light" data-src = "#re-2" fill="#FF0000" stroke="#000000" stroke-width="5" data-fill = "#FF0000" data-stroke = "#000000" />
         <ellipse cx="0" cy="446" id="" fill="#0000ff" data-src="#re-2" stroke="#000000" stroke-width="5" rx="24" ry="15" data-fill = "#0000ff" data-stroke = "#000000"/>
         <ellipse cx="600" cy="446" id="" fill="#0000ff" data-src="#re-2" stroke="#000000" stroke-width="5" rx="24" ry="15" data-fill = "#0000ff" data-stroke = "#000000"/>
         <ellipse cx="620" cy="446" id="" fill="#0000ff" data-src="#el-2" stroke="#000000" stroke-width="5" rx="24" ry="15" data-fill = "#0000ff" data-stroke = "#000000"/>
       </g>
    </svg>
    <!-- 对应div group -->
    <div id="fade">
         <div id="rectBox" class="lightbox"></div> 
         <div id="ellipseBox" class="lightbox"></div>
         <div id="pathBox" class="lightbox"></div>
         <div id="el-1" class="lightbox"></div>
         <div id="re-1" class="lightbox"></div>
         <div id="el-2" class="lightbox"></div>
         <div id="re-2" class="lightbox"></div>
    </div>
  
    <script>
    	$(function(){
    		var vInit=function(){//恢复默认颜色
    			$("svg").find("rect,ellipse,path").each(function(){
    					var ofill=$(this).attr("data-fill");//默认的填充颜色
    					var ostroke=$(this).attr("data-stroke");//默认的边框颜色
    					$(this).attr({"fill":ofill,"stroke":ostroke}).removeAttr("filter");
    			});
    		};
    		var divTop,divLeft;
    				  
    		function edgeCal(iTop,iLeft,svgLeft,svgTop,svgWidth,svgHeight,offsetTop,offsetLeft,oHeight,oWidth,dataWidth,dataHeight){
    			divTop=iTop;
    			divLeft=iLeft;
    			if(svgTop>iTop){//上边框出界
    				if(svgLeft>iLeft){//左边框出界
    					divTop=offsetTop+oHeight;
    					divLeft=offsetLeft+oWidth;
    				}else{
    					if((iLeft+dataWidth)>(svgLeft+svgWidth)){
    						divTop=offsetTop+oHeight;
    						divLeft=offsetLeft-dataWidth;
    					}else{
    						divTop=iTop+dataHeight+oHeight;
    					}
    				}
    			}else{
    				if(svgLeft>iLeft){//左边框出界
    					divLeft=offsetLeft+oWidth;
    					divTop=offsetTop-(dataHeight-oHeight)/2;
    					if((divTop+dataHeight)>(svgTop+svgHeight)){
    						divTop=offsetTop-dataHeight;
    					}
    				}else{
    					if((iLeft+dataWidth)>(svgLeft+svgWidth)){//右边框出界
    						divLeft=offsetLeft-dataWidth;
    						divTop=offsetTop-(dataHeight-oHeight)/2;
    						if((divTop+dataHeight)>(svgTop+svgHeight)){
    							divTop=offsetTop-dataHeight;
    						}
    					}
    				}
    			}
    		}
    		var getFillColor="#00ff00";//填充颜色
    		var getStrokeColor="#ff0000";//边框颜色
    		$("svg").find("rect,ellipse,path").each(function(){
    			$(this).hover(function(e){
    				e.preventDefault();
    				vInit();
    				var svgLeft=$("svg").offset().left;//svg的左边距
    				var svgTop=$("svg").offset().top;//svg的上边距
    				var svgWidth=$("svg").outerWidth();//svg的宽度
    				var svgHeight=$("svg").outerHeight();//svg的高度
    				

    				$(this).attr({"fill":getFillColor,"stroke":getStrokeColor});//填充 颜色和修改边框
    				$(this).on("click",function(e){
    				   e.preventDefault();
    				   e.stopPropagation();
    				   $(this).attr({"fill":getFillColor,"stroke":getStrokeColor});
    				   $("#fade,#fade>div").css({"display":"none"});
    				   var dataSrc=$(this).attr("data-src");//获取对应的pop的div
    				   var dataHeight=$(dataSrc).outerHeight();//对应div的高度
    				   var dataWidth=$(dataSrc).outerWidth();//对应div的宽度
    				   
    				   var thisBound=$(this).get(0).getBoundingClientRect();//获取svg里对象
    				   var oHeight=thisBound.bottom-thisBound.top;//获取图形对象的高度
    				   var oWidth=thisBound.right-thisBound.left;//获取图形对象的宽度
    				   
    				   
    				   var iTop=parseInt($(this).offset().top-dataHeight); //当前对象的高度-对应div的高度
    				   var iLeft=parseInt($(this).offset().left-(dataWidth/2)+oWidth/2);
  
    				   
    				   edgeCal(iTop,iLeft,svgLeft,svgTop,svgWidth,svgHeight,$(this).offset().top,$(this).offset().left,oHeight,oWidth,dataWidth,dataHeight);
    				   $(dataSrc).css({"top":divTop+"px","left":divLeft+"px"});//对应div的位置
    			       $("#fade,"+dataSrc+"").css({"display":"block"});	   
    			       
    				   $(dataSrc).on("click",function(e){
    				   	    e.preventDefault();
                    
                            $(this).css({"display":"none"});
                            $("#fade,#fade>div").css({"display":"none"});
    				        vInit(); 
    				   })
    			   });
    			});
    			
    			
    			/* 防止fade内的div冒泡到父级 */
    			/*	$("#fade").children("div").each(function(){
    			$(this).on("click",function(e){//防止冒泡
    					e.preventDefault();
                        alert("ss");
                        $(this).css({"display":"none"});
    				    vInit();
    				    return;
                        
    				})
    		   });*/
    		  
    	    })
    	});
    </script>
</body>
</html>
